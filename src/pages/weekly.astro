---
import BaseLayout from '@layouts/BaseLayout.astro';
import { generateMarketBrief } from '../utils/briefGenerator';
import { SIMULATED_TREND_DATA } from '../utils/trendEngine';

// For this tool, we use the simulated data as our "Weekly Dataset"
const brief = generateMarketBrief(SIMULATED_TREND_DATA);
---

<BaseLayout
  title={brief.title}
  description={brief.summary}
  canonicalURL="https://vnmarketinsights.com/weekly/"
  mainClass="container-wide"
>
  <div class="weekly-page text-slate-900">
    <div class="weekly-sample-banner" role="status">
      Sample report ‚Äî based on illustrative data. Real weekly reports will be available when our data pipeline is ready.
    </div>
    <div class="report-header">
      <div class="badge-row">
        <span class="report-badge">WEEKLY REPORT</span>
        <span class="report-date">{brief.dateRange}</span>
      </div>
      <h1 class="report-title">{brief.title}</h1>
      <p class="report-summary">{brief.summary}</p>
    </div>

    <div class="report-content">
      <div class="report-grid">
        <!-- Left Column: Highlights -->
        <div class="highlights-col">
          <section class="report-section">
            <h3>üöÄ Top Growing Categories</h3>
            <ul class="tag-list">
              {brief.topCategories.map(c => <li class="tag">{c}</li>)}
            </ul>
          </section>

          <section class="report-section">
            <h3>üì¶ Trending Products</h3>
            <div class="product-list">
              {brief.topProducts.map((p, i) => (
                <div class="product-item">
                  <span class="product-rank">{i + 1}</span>
                  <span class="product-name">{p}</span>
                </div>
              ))}
            </div>
          </section>

          <section class="report-section">
            <h3>‚ö†Ô∏è Market Risks</h3>
            <ul class="risk-list">
              {brief.riskWarnings.map(r => <li>{r}</li>)}
            </ul>
          </section>
        </div>

        <!-- Right Column: Markdown Export -->
        <div class="export-col">
          <div class="export-card">
            <div class="export-header">
              <span>Full Report (Markdown)</span>
              <button id="download-md" class="download-btn" data-content={brief.markdown}>
                Download .md
              </button>
            </div>
            <div class="markdown-preview">
              <pre>{brief.markdown}</pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script is:inline>
    document.getElementById('download-md').addEventListener('click', (e) => {
      const content = e.target.getAttribute('data-content');
      const blob = new Blob([content], { type: 'text/markdown' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'market-brief.md';
      a.click();
    });
  </script>

  <style is:global>
    .weekly-page { width: 100%; margin: 0 auto; padding: 4rem 0; }
    .weekly-sample-banner {
      background: #fef3c7;
      color: #92400e;
      padding: 0.75rem 1.25rem;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 2rem;
      text-align: center;
    }
    .report-header { margin-bottom: 4rem; text-align: center; max-width: 800px; margin-left: auto; margin-right: auto; }
    .badge-row { display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1.5rem; }
    .report-badge { background: #1a1a1a; color: white; padding: 4px 12px; border-radius: 4px; font-size: 0.75rem; font-weight: 800; }
    .report-date { color: #666; font-size: 0.875rem; font-weight: 600; }
    .report-title { font-size: 3rem; font-weight: 850; letter-spacing: -0.03em; line-height: 1.1; margin-bottom: 1.5rem; }
    .report-summary { font-size: 1.25rem; color: #444; line-height: 1.6; }

    .report-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 3rem; }
    
    .report-section { margin-bottom: 3rem; }
    .report-section h3 { font-size: 0.875rem; font-weight: 800; text-transform: uppercase; color: #888; letter-spacing: 0.05em; margin-bottom: 1.5rem; }
    
    .tag-list { display: flex; flex-wrap: wrap; gap: 0.75rem; list-style: none; padding: 0; }
    .tag { background: #eef2ff; color: #4f46e5; padding: 6px 16px; border-radius: 200px; font-weight: 700; font-size: 0.875rem; }

    .product-list { display: flex; flex-direction: column; gap: 1rem; }
    .product-item { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: white; border: 1px solid #f0f0f0; border-radius: 12px; }
    .product-rank { width: 24px; height: 24px; background: #f0f0f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 800; color: #666; }
    .product-name { font-weight: 700; color: #1a1a1a; }

    .risk-list { color: #d946ef; font-weight: 500; font-size: 0.95rem; line-height: 1.5; padding-left: 1.25rem; }
    .risk-list li { margin-bottom: 0.75rem; }

    .export-card { background: #fdfdfd; border: 1px solid #eee; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.02); }
    .export-header { display: flex; justify-content: space-between; align-items: center; padding: 1.25rem 2rem; background: #f8f8f8; border-bottom: 1px solid #eee; }
    .export-header span { font-size: 0.875rem; font-weight: 700; color: #666; }
    .download-btn { background: #0066ff; color: white; border: none; padding: 6px 16px; border-radius: 6px; font-weight: 700; font-size: 0.75rem; cursor: pointer; }
    
    .markdown-preview { padding: 2rem; background: white; overflow-x: auto; font-family: 'Inter', system-ui, sans-serif; }
    .markdown-preview pre { white-space: pre-wrap; word-break: break-all; font-size: 0.9rem; color: #333; line-height: 1.6; }

    @media (max-width: 900px) {
      .report-grid { grid-template-columns: 1fr; }
      .report-title { font-size: 2.25rem; }
    }
  </style>
</BaseLayout>
